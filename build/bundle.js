var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function r(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(t,n,o){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function c(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function l(e){return document.createElement(e)}function d(){return e=" ",document.createTextNode(e);var e}function f(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}let p;function m(e){p=e}function h(e){(function(){if(!p)throw new Error("Function called outside component initialization");return p})().$$.on_mount.push(e)}const g=[],$=[],v=[],y=[],b=Promise.resolve();let x=!1;function w(e){v.push(e)}let _=!1;const k=new Set;function E(){if(!_){_=!0;do{for(let e=0;e<g.length;e+=1){const t=g[e];m(t),L(t.$$)}for(g.length=0;$.length;)$.pop()();for(let e=0;e<v.length;e+=1){const t=v[e];k.has(t)||(k.add(t),t())}v.length=0}while(g.length);for(;y.length;)y.pop()();x=!1,_=!1,k.clear()}}function L(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(w)}}const j=new Set;function M(e,t){e&&e.i&&(j.delete(e),e.i(t))}function N(e,n,s){const{fragment:i,on_mount:c,on_destroy:a,after_update:u}=e.$$;i&&i.m(n,s),w(()=>{const n=c.map(t).filter(r);a?a.push(...n):o(n),e.$$.on_mount=[]}),u.forEach(w)}function T(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function q(e,t){-1===e.$$.dirty[0]&&(g.push(e),x||(x=!0,b.then(E)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function z(t,r,s,i,c,a,l=[-1]){const d=p;m(t);const f=r.props||{},h=t.$$={fragment:null,ctx:null,props:a,update:e,not_equal:c,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:l};let g=!1;if(h.ctx=s?s(t,f,(e,n,...o)=>{const r=o.length?o[0]:n;return h.ctx&&c(h.ctx[e],h.ctx[e]=r)&&(h.bound[e]&&h.bound[e](r),g&&q(t,e)),n}):[],h.update(),g=!0,o(h.before_update),h.fragment=!!i&&i(h.ctx),r.target){if(r.hydrate){const e=function(e){return Array.from(e.childNodes)}(r.target);h.fragment&&h.fragment.l(e),e.forEach(u)}else h.fragment&&h.fragment.c();r.intro&&M(t.$$.fragment),N(t,r.target,r.anchor),E()}m(d)}class C{$destroy(){T(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const P=[];const S=function(t,n=e){let o;const r=[];function i(e){if(s(t,e)&&(t=e,o)){const e=!P.length;for(let e=0;e<r.length;e+=1){const n=r[e];n[1](),P.push(n,t)}if(e){for(let e=0;e<P.length;e+=2)P[e][0](P[e+1]);P.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,c=e){const a=[s,c];return r.push(a),1===r.length&&(o=n(i)||e),s(t),()=>{const e=r.indexOf(a);-1!==e&&r.splice(e,1),0===r.length&&(o(),o=null)}}}}(null);function A(t){let n,o,r,s;return{c(){n=l("div"),o=l("div"),r=d(),s=l("div"),s.innerHTML='<h4 class="svelte-rd4r8a">Queens DSNY Needs</h4> \n        <div class="legend-item svelte-rd4r8a"><div class="marker-district">1</div> \n            <div class="label svelte-rd4r8a">District-wide need</div></div> \n        <div class="legend-item svelte-rd4r8a"><div class="marker-location">1</div> \n            <div class="label svelte-rd4r8a">Location-specific need</div></div>',f(o,"id","map"),f(o,"class","svelte-rd4r8a"),f(s,"class","legend svelte-rd4r8a"),f(n,"class","map-view svelte-rd4r8a")},m(e,i){a(e,n,i),c(n,o),t[3](o),c(n,r),c(n,s)},p:e,i:e,o:e,d(e){e&&u(n),t[3](null)}}}function H(e,t,n){let o,r,s;return i(e,S,e=>n(2,o=e)),h(()=>{mapboxgl.accessToken="pk.eyJ1IjoiemhpayIsImEiOiJjaW1pbGFpdHQwMGNidnBrZzU5MjF5MTJiIn0.N-EURex2qvfEiBsm-W9j7w",n(1,s=new mapboxgl.Map({container:r,style:"mapbox://styles/zhik/cka343h1701vn1imnfp2nptkj",center:[-73.8217,40.67],zoom:10.3}))}),e.$$.update=()=>{6&e.$$.dirty&&s&&o&&o.features&&s.on("load",()=>{s.addSource("needs",{type:"geojson",data:o}),s.addLayer({id:"needs-streets",type:"line",source:"needs",paint:{"line-color":"#363636","line-opacity":.8,"line-width":3},filter:["==","$type","LineString"]}),s.on("click","needs-streets",(function(e){const t=e.features[0],{type:n,request:o,explanation:r,tracking_code:i}=t.properties,c=i.slice(0,3);(new mapboxgl.Popup).setLngLat(e.lngLat).setHTML(`<h3>${o}</h3><p>${c}</p><p>${r}</p>`).addTo(s)})),s.on("mouseenter","needs-streets",(function(){s.getCanvas().style.cursor="pointer"})),s.on("mouseleave","needs-streets",(function(){s.getCanvas().style.cursor=""})),o.features.filter(e=>"Point"===e.geometry.type).forEach(e=>{const t=document.createElement("div"),{type:n,request:o,explanation:r,tracking_code:i}=e.properties,c=i.slice(0,3);t.className="marker-"+n,t.textContent=e.properties.revised_priority,new mapboxgl.Marker(t).setLngLat(e.geometry.coordinates).setPopup(new mapboxgl.Popup({offset:5}).setHTML(`<h3>${o}</h3><p>${c}</p><p>${r}</p>`)).addTo(s)})})},[r,s,o,function(e){$[e?"unshift":"push"](()=>{n(0,r=e)})}]}class I extends C{constructor(e){super(),z(this,e,H,A,s,{})}}function O(t){let n,o;const r=new I({});return{c(){var e;n=l("main"),(e=r.$$.fragment)&&e.c(),f(n,"class","svelte-171nhqz")},m(e,t){a(e,n,t),N(r,n,null),o=!0},p:e,i(e){o||(M(r.$$.fragment,e),o=!0)},o(e){!function(e,t,n,o){if(e&&e.o){if(j.has(e))return;j.add(e),(void 0).c.push(()=>{j.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}}(r.$$.fragment,e),o=!1},d(e){e&&u(n),T(r)}}}function B(e){return h(()=>{(async()=>{const e=await(await fetch("data/needs.geojson")).json();S.set(e)})()}),[]}return new class extends C{constructor(e){super(),z(this,e,B,O,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
